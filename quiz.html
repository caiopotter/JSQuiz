<!DOCTYPE html>
<html>
	<head>
		<link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
		<style>
			.main{
				color: white;
				text-align: center;
			}
			li{
				list-style-type: none;
				color: white;
			}
			.mainInput{
				border: none;
				background-color: #8080805e;
				color: white;
				padding: 5px;
				border-radius: 5px;
			}
			.slide{
				position: absolute;
				left: 0px;
				top: 0px;
				width: 100%;
				z-index: 1;
				opacity: 0;
				transition: opacity 0.5s;
			}
			.active-slide{
				opacity: 1;
				z-index: 2;
			}
			.quiz-container{
				position: relative;
				height: 200px;
				margin-top: 40px;
			}
		</style>
	</head>

	<body style="background-color: purple;">
		<div id="mainPage">
			<h1 class="main">Quiz do Caio</h1>
				Digite seu nome e clique em iniciar: <input id="userName" class="mainInput" type="text" name="name">
			<button id="mainPageButton" onclick="nextPage()">Iniciar</button>
		</div>
		<div class="quiz-container">
			<div id="quiz"></div>
		</div>
		<div id="countdown"></div>
		<button id="previous">Previous Question</button>
		<button id="next">Next Question</button>
		<button id="submit" style="display: none;"onclick="showResults()">Finalizar Quiz</button>

		<div id="results"></div>


		<script type="text/javascript">
			//referência: https://www.sitepoint.com/simple-javascript-quiz/
			const quizContainer = document.getElementById('quiz');
			const resultsContainer = document.getElementById('results');
			const submitButton = document.getElementById('submit');
			const mainPage = document.getElementById('mainPage');
			const previousButton = document.getElementById("previous");
			const nextButton = document.getElementById("next");
			let currentSlide = 0;
			previousButton.style.display = "none";
			nextButton.style.display = "none";
			submitButton.style.display = "none";

			const questions = [
				{
					question: "Questão 1",
					answers: {
						a: "Resposta 1",
						b: "Resposta 2",
						c: "Resposta 3"
					},
					correctAnswer: "a"
				},
				{	question: "Questão 2",
					answers: {
						a: "Resposta 1",
						b: "Resposta 2",
						c: "Resposta 3"
					},
					correctAnswer: "b"
				},
				{	question: "Questão 3",
					answers: {
						a: "Resposta 1",
						b: "Resposta 2",
						c: "Resposta 3"
					},
					correctAnswer: "c"
				}
			];

			function startWatch(){
				var countDownDate = new Date(new Date().getTime() + 60 * 1000).getTime();


					window.countdown = setInterval(function(){
					var now = new Date().getTime();
					var distance = countDownDate - now;

					var days = Math.floor(distance / (1000 * 60 * 60 * 24));
					var hours = Math.floor((distance % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
					var minutes = Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60));
					var seconds = Math.floor((distance % (1000 * 60)) / 1000);
					var miliseconds = Math.floor(distance % 1000);

					document.getElementById("countdown").innerHTML = minutes + "m " + seconds + "s " + miliseconds + "ms ";

					if (distance < 0) {
						clearInterval(window.countdown);
						count = document.getElementById("countdown");
						count.innerHTML = "0m 0s 000ms";
						count.style.color = "red";
					}

				}, 1);
			}

			function restartWatch(){
				clearInterval(window.countdown);
				startWatch();
			}

			function nextPage(){
				mainPage.style.display = "none";
				buildQuiz();
				startWatch();
			}

			function showSlide(n) {
				const slides = document.querySelectorAll(".slide");

				slides[currentSlide].classList.remove('active-slide');
				slides[n].classList.add('active-slide');
				currentSlide = n;
				if(currentSlide===0){
					previousButton.style.display = 'none';
				}
				else{
					previousButton.style.display = 'inline-block';
				}
				if(currentSlide===slides.length-1){
					nextButton.style.display = 'none';
					submitButton.style.display = 'inline-block';
				}
				else{
					nextButton.style.display = 'inline-block';
					submitButton.style.display = 'none';
				}
			}

			function showNextSlide() {
				showSlide(currentSlide + 1);
				restartWatch();
			}

			function showPreviousSlide() {
				showSlide(currentSlide - 1);
			}

			previousButton.addEventListener("click", showPreviousSlide);
			nextButton.addEventListener("click", showNextSlide);

			function buildQuiz(){
				const output = [];

				questions.forEach(
					(currentQuestion, questionNumber) => {
						const answers = [];

						for(letter in currentQuestion.answers){
							answers.push(
								`<label>
									<input type="radio" name="question${questionNumber}" value="${letter}">
									${letter} : ${currentQuestion.answers[letter]}
								</label>`);
						}
					output.push(
					        `<div class="slide">
					        <div class="question"> ${currentQuestion.question} </div>
					        <div class="answers"> ${answers.join('')} </div>
					        </div>`
					      );

					}


					);
				  quizContainer.innerHTML = output.join('');
				  showSlide(0);

			}

			function showResults(){
				clearInterval(window.countdown);
				const answerContainers = quizContainer.querySelectorAll('.answers');
				console.log(answerContainers);
				let numCorrect = 0;

				questions.forEach( (currentQuestion, questionNumber) => {
					const answerContainer = answerContainers[questionNumber];
					const selector = 'input[name=question'+questionNumber+']:checked';
					const userAnswer = (answerContainer.querySelector(selector) || {}).value;


					if(userAnswer===currentQuestion.correctAnswer){
						numCorrect++;
						highlightAnswer(answerContainer, currentQuestion, 'lightgreen');						
					}else{
						highlightAnswer(answerContainer, currentQuestion, 'red');
					}

				});

				resultsContainer.innerHTML = numCorrect + ' out of ' + questions.length;

			}

			function highlightAnswer(answerContainer, currentQuestion, color){
				labels = answerContainer.getElementsByTagName('LABEL');
						for(var i = 0; i < labels.length; i++){
							input = labels[i].getElementsByTagName('INPUT');
							if(input[0].value === currentQuestion.correctAnswer){
								labels[i].style.color = color;
							}

						}
			}

			submitButton.addEventListener('click', showResults);

		</script>
	</body>
</html>